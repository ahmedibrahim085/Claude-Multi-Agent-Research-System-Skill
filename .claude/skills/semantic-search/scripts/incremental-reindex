#!/usr/bin/env bash
# Incremental Reindex - Orchestrator with Auto-Fallback
#
# This script uses IndexFlatIP (MCP's proven approach) with auto-fallback to
# full reindex. Detects file changes via Merkle tree, then performs complete
# reindex to ensure no stale data or desynchronization issues.
#
# Usage:
#   incremental-reindex PROJECT_PATH [--full] [--max-age MINUTES] [--check-only]
#
# Examples:
#   incremental-reindex .                    # Incremental if >360min old (6 hours)
#   incremental-reindex . --full             # Force full reindex
#   incremental-reindex . --max-age 30       # Reindex if >30min old
#   incremental-reindex . --check-only       # Only check, don't reindex

VENV_PYTHON="$HOME/.local/share/claude-context-local/.venv/bin/python"
export PYTHONPATH="$HOME/.local/share/claude-context-local"

# Get script directory
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

# Run Python implementation
"$VENV_PYTHON" "$SCRIPT_DIR/incremental_reindex.py" "$@"
